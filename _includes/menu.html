<nav>
    <ul>
        {% for p in site.html_pages | sort: 'name' %}
            {% if page.language == p.language and p.tags contains 'menu' %}
                {% assign css_class = '' %}
                {% if page.permalink == p.permalink %}
                    {% assign css_class = 'active' %}
                {% endif %}
                <li>
                    <a href="{{ p.permalink | default: '/' | relative_url }}" class="{{ css_class }}">{{ p.title }}</a>
                </li>
            {% endif %}
        {% endfor %}

        <li>
            {% if page.permalink == '/' %}
                de |
                <a href="{{ '/it/' | relative_url }}">it</a>
            {% elsif page.permalink == '/it/' %}
                <a href="{{ '/' | relative_url }}">de</a> |
                it
            {% else %}
                {% for language in site.languages %}
                    {% if language.key != 'de' %} | {% endif %}
                    {% if language.key == page.language %}
                        {{language.value}}
                    {% else %}
                        {% if page.language == 'it' && page.permalink == '/it/' %}
                        <a href="{{ '/' | relative_url }}" hreflang="{{ language.key }}">
                        {% else %}
                        <a href="{{ page.permalink | replace: page.language,language.key | relative_url }}" hreflang="{{ language.key }}">
                        {% endif %}
                            {{ language.value }}
                        </a>
                    {% endif %}
                {% endfor %}
            {% endif %}
        </li>
    </ul>
</nav>